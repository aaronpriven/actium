#!/usr/bin/perl
# vimcolor: #000030

# makepoints
#
# This program generates the point schedules associated with 
# particular signs.

# TODO - 
# 1) Change "headnum" routine so that if two adjacent numbers have
# the same color, the slash between them uses that color (instead of
# grey80) - DONE -- but somehow undone when other things done -- redo
# 7) Add a "noteonly" database
# 8) deal with two-level templates
# 10) Make sure beginning NL on each sign is gone

# DONE or irrelevant
# 2) Change the default number of columns to be derived from the "SignType"
# database, and add the number of added columns triggered by "usedcount" to it
# 3) change headnum routine so it uses "headnum-norule" for first headnum
#   - (irrelevant with new Indesign routine)
# 4) (not strictly makepoints) Change the "Signtype" value list in signs.fp5
# to be derived from the signtype database  - # DONE
# 5) Change everything to Indesign tags # DONE !
# 6) Make the schedules on the right, instead of the left, of the sign
# 9) Fix "last stop" destinations so they show up -- DONE (well,
#    I decided to make them disappear instead)

use strict;

# initialization

use FindBin('$Bin'); 
   # so $Bin is the location of the very file we're in now

use lib $Bin; 
   # there are few enough files that it makes sense to keep
   # main program and library in the same directory

# libraries dependent on $Bin


use Data::Dumper;

use FPMerge qw(FPread FPread_simple);
use IDTags;
use Skedfile qw(Skedread merge_columns);
use Skeddir;
use Skedvars;
use Skedtps qw(tphash tpxref);
use Byroutes 'byroutes';
use Myopts;

my %options;
Myopts::options (\%options, Skeddir::options(), 'quiet!');
# command line options in %options;

$| = 1; # this shouldn't be necessary to a terminal, but apparently it is

print <<"EOF" unless $options{quiet};
makepoints - This is the makepoints program. It creates point schedules
from the data exported from the FileMaker databases.

EOF

my $signup;
$signup = (Skeddir::change (\%options))[2];
# Takes the necessary options to change directories, plus 'quiet', and
# then changes directories to the "Skeds" base directory.

system ("pwd");

#!/usr/bin/perl

@ARGV = "/Volumes/Bireme/ACTium/db/f08/headways/SYSTEM SAT SCHEDULES FALL08.prt.prt" 
   if $ENV{'RUNNING_UNDER_AFFRUS'};
   
use warnings;
use strict;

$/ = "\cL\cM";

my @pages;

while (<>) {
#   chomp;
   s/\r\n?/\n/g;
   push @pages , [ split(/\n/) ] ;
   $pages[-1][-1] = "\cL\cM";

}

my $count = 0;

until ($count >= $#pages ) { 

   $count++;
   
   next if ( $pages[$count-1][10] =~ /DIV-IN  STOP$/ );
   next if ( $pages[$count-1][10] =~ /^Notes:/ );
   
   # If the previous page has the proper final characters, it's good. 
   # Otherwise, add the current page to the previous page, and delete 
   # the current page.
   
   
   for (10..38) { # data lines only
      if ($pages[$count-1][$_] ) {
         $pages[$count-1][$_] .= " " . $pages[$count][$_];
      }
      else {
         $pages[$count-1][$_] = $pages[$count][$_];
      }

   } 
   
   splice (@pages, $count, 1);

}

for (@pages) {
   print ( join "\r\n" , @{$_} ) ;
}
